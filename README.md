# Мониторинг Интернета ЦСО-1

Утилита, висящая в фоне системы, выполняющая периодические пинги и трейсы проверки интернета в общежитии МТУСИ

[Панель мониторинга](https://monitor.slavapmk.ru)

# Windows

### Установка

Для подключения к мониторингу интернета выполните следующие действия

1. **Установите на компьютер Python**
    1. Скачайте [Windows Installer x64](https://www.python.org/ftp/python/3.12.10/python-3.12.10-amd64.exe)

        [Для других систем](https://www.python.org/downloads/release/python-31210/) (вероятно уже предустановлен)
    2. Прожмите `Add python.exe to PATH` и нажмите `Customize installation`
        <img src="https://i.imgur.com/jXJB3Dk.png">
    3. `Next`
        <img src="https://i.imgur.com/uwyztyH.png">
    4. `Install Python 3.12 for all users` -> `Install`
        <img src="https://i.imgur.com/EaQDLtz.png">
2. **Скачайте файл проекта**

    Code -> Download ZIP
    <img src="https://i.imgur.com/pGQRdmk.png">
3. **Распакуйте архив в директорию, не содержащую пробелы в имени.**
    
    Например, создайте папку `C:\Monitoring` и распакуйте файлы в директорию
    <img src="https://i.imgur.com/pVrtDGL.png">
4. **Запустите файл `install.bat`**

    Это установит все необходимые библиотеки для работы
    <img src="https://i.imgur.com/bS20hz0.png">
5. **Сделайте начальную настройку**
   1. Сделайте тестовый запуск

       Запустите файл `run.bat`, через несколько секунд закройте окно
       <img src="https://i.imgur.com/UvPAYoX.png">

       Появится файл `config.yaml`, настройте его
       <img src="https://i.imgur.com/UvPAYoX.png">
   2. Установите переменную `room` на свою (только численное значение)
       <img src="https://i.imgur.com/8Il2IHR.png">

       При желании можете более подробно установить свои настройки, описание ниже
6. **Запустите `add_to_startup.bat`, это добавит мониторинг в автозапуск системы**
    <img src="https://i.imgur.com/SaMXbV3.png">

### Отключение

1. Остановите запущенный процесс в диспечере задач
    <img src="https://i.imgur.com/3B6YYi9.png">
2. Для отключения автозапуска **либо** отключите его в диспечере задач
    <img src="https://i.imgur.com/eJBuMBi.png">
    **Либо** запустите файл `remove_from_startup.bat`
    <img src="https://i.imgur.com/806tJV1.png">
3. После этого можете удалить папку
    <img src="https://i.imgur.com/1JoI60H.png">

# Конфигурация

Стандартный конфиг выглядит следующим образом
```yaml
room: null
endpoint: https://monitor.slavapmk.ru
ping:
  standart:
    packet_count: 1
    delay: 10
  check:
    packet_count: 10
  continious:
    packet_count: 1
    delay: 1
timing:
  timeouts:
    connect_secs: 10
    upload_secs: 300
  trace_check_secs: 300
  rotation_secs: 1000
  sender_check_secs: 60
```

1. Число int32 `room` указывает номер комнаты, отображаемый на графике, принимаются значения **от 100 до 555**
2. Строчка `endpoint` ведёт на корень сервера отгрузки данных. Фактически отгрузка ведётся на `{endpoint}/upload/{room}/`

   Пример: https://monitor.slavapmk.ru/upload/111/
3. Блок `ping` отвечает за настройку параметров проведения ping-запросов
   1. Блок `standart` отвечает за стандартные проверки
      2. Число int32 `delay` отвечает за время между проверками
      1. Число int32 `packet_count` отвечает за количество пакетов во время короткой проверки

      По стандарту: **1 пакет** раз в **10 секунд**
   2. Блок `check` отвечает за контролную проверку, если стандартная не прошла
      1. Число int32 `packet_count` отвечает за количество пакетов, отправленных во время одиночной проверки, если стандартный короткий пинг не прошёл

      Если эта проверка не сработает, то программа переходит в режим ожидания возобновленя сети - проверки должны проходить чаще

      По стандарту: **2 пакета**
   3. Блок `continious` отвечает за ожидающую проверку, которая работает до возобновления работы интернета
      2. Число int32 `delay` отвечает за время между проверками
      1. Число int32 `packet_count` отвечает за количество пакетов во время ожидания сети

      По стандарту: **1 пакет** раз в **1 секунду**
4. Блок `timing` отвечает за настройку остальных параметров времени
   1. Блок `timeouts` отвечает за максимальное время ожидания
      1. Число int32 `connect_secs` отвечает за время подключения к серверу
      
      По стандарту: **10 секунд**
      2. Число int32 `upload_secs` отвечает за время отгрузки одного файла
      
      По стандарту: **300 секунд** (5 минут)
   2. Число int32 `trace_check_secs` отвечает за регулярную проверку полную trace маршрута до адреса проверки
      
      По стандарту: **300 секунд** (5 минут)
   3. Число int32 `rotation_secs` отвечает за время между сбором данных в архив и отправки в очередь на отправку
      
      По стандарту: **1000 секунд** (примерно 17 минут)
   4. Число int32 `sender_check_secs` отвечает за время между регулярными проверками на наличие файлов на отправку
      
      По стандарту: раз в **60 секунд** (1 минута)
